if(typeof delegate=="undefined")delegate=function(method,instance){return function(){return method.apply(instance,arguments)}};Date.now=Date.now||function(){return(new Date).getTime()};if(typeof console=="undefined")console={};if(typeof console.log!="function")console.log=function(msg){};(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(window.requestAnimationFrame===undefined){window.requestAnimationFrame=function(callback,element){var currTime=Date.now(),timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}window.cancelAnimationFrame=window.cancelAnimationFrame||function(id){window.clearTimeout(id)}})();(function(mf){mf.utils=mf.utils||{};function Maths(){}mf.utils.Maths=Maths;Maths.easeLinear=function(t,b,c,d){return b+c*(t/d)};Maths.easeOutQuad=function(t,b,c,d){t=t/d;return-c*t*(t-2)+b};Maths.easeOutElastic=function(t,b,c,d,a,p){if(t==0){return b}t=t/d;if(t==1){return b+c}var s=0;if(p!=0){p=d*.3}if(a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b};Maths.bezierLinear=function(t,p0,p1){var t1=1-t;var x=t1*p0.x+t*p1.x;var y=t1*p0.y+t*p1.y;return new mf.geom.Vector2D(x,y)};Maths.bezierQuad=function(t,p0,p1,p2){var t1=1-t;var x=t1*t1*p0.x+2*t1*t*p1.x+t*t*p2.x;var y=t1*t1*p0.y+2*t1*t*p1.y+t*t*p2.y;return new mf.geom.Vector2D(x,y)};Maths.bezierCubic=function(t,p0,p1,p2,p3){var t1=1-t;var x=t1*t1*t1*p0.x+3*t1*t1*t*p1.x+3*t1*t*t*p2.x+t*t*t*p3.x;var y=t1*t1*t1*p0.y+3*t1*t1*t*p1.y+3*t1*t*t*p2.y+t*t*t*p3.y;return new mf.geom.Vector2D(x,y)};Maths.bezierCasteljau=function(t,points){var i,j;if(points.length==1){points=points[0]}var output=[];for(i=0;i<points.length;i++){output.push(new mf.geom.Vector2D(points[i].x,points[i].y))}for(i=1;i<points.length;i++){for(j=0;j<points.length-i;j++){output[j].x=(1-t)*output[j].x+t*output[j+1].x;output[j].y=(1-t)*output[j].y+t*output[j+1].y}}return output[0]};Maths.geoDistance=function(lat1,long1,lat2,long2,radius){if(typeof radius=="undefined")radius=6378137;lat1*=Math.PI/180;long1*=Math.PI/180;lat2*=Math.PI/180;long2*=Math.PI/180;var i=Math.cos(lat1)*Math.cos(lat2)*Math.cos(long1)*Math.cos(long2)+Math.cos(lat1)*Math.sin(long1)*Math.cos(lat2)*Math.sin(long2)+Math.sin(lat1)*Math.sin(lat2);var j=Math.acos(i);if(isNaN(j)){j=0}return radius*j}})(mf=window.mf||{});(function(mf){mf.dom=mf.dom||{};function Viewport(){}mf.dom.Viewport=Viewport;Viewport.isInViewport=function(element){var rect=element.getBoundingClientRect();var html=document.documentElement;return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||html.clientHeight)&&rect.right<=(window.innerWidth||html.clientWidth)}})(mf=window.mf||{});(function(mf,$){mf.animation=mf.animation||{};function TimeLine(options){this.options=$.extend({length:1},options);this.time=0;this.length=this.options.length;this.easing={easingFunction:mf.utils.Maths.easeOutQuad,startTime:0,duration:0,startValue:0,endValue:0,on:false}}mf.animation.TimeLine=TimeLine;TimeLine.TIME_CHANGED="eventTimeChanged";TimeLine.PLAY="eventPlay";TimeLine.STOP="eventStop";var p=TimeLine.prototype;p.ease=function(){if(this.easing.on){var t=Date.now()-this.easing.startTime;var d=this.easing.duration;if(t>=d){this.easing.on=false;this.setTime(this.easing.endValue)}else{this.setTime(this.easing.easingFunction(t,this.easing.startValue,this.easing.endValue-this.easing.startValue,d));requestAnimationFrame(delegate(this.ease,this))}}};p.moveToTime=function(t,options){options=$.extend({duration:Math.min(1e3,Math.abs(t-this.time)),easing:mf.utils.Maths.easeOutQuad},options);this.easing.startTime=Date.now();this.easing.duration=options.duration;this.easing.startValue=this.time;this.easing.endValue=t;this.easing.easingFunction=options.easing;if(!this.easing.on){this.easing.on=true;requestAnimationFrame(delegate(this.ease,this))}};p.setTime=function(t){if(t!=this.time){this.time=t;$(this).trigger(TimeLine.TIME_CHANGED)}};p.play=function(){$(this).trigger(TimeLine.PLAY);this.moveToTime(this.length,{duration:this.length-this.time,easing:mf.utils.Maths.easeLinear})};p.stop=function(t){if(typeof t!="undefined"){this.setTime(t)}$(this).trigger(TimeLine.STOP);this.easing.on=false}})(mf=window.mf||{},jQuery);(function(mf,$){mf.animation=mf.animation||{};function ScrollLine(options){delegate(mf.animation.TimeLine,this)(options);this.options=$.extend({touchEnabled:false,touchHeight:700,height:5e3,minScrollGap:3},this.options);this.time=0;this.length=this.options.length;this.options.touchEnabled=this.options.touchEnabled&&"ontouchstart"in document.documentElement;this.touch={};if(this.options.touchEnabled){console.log("Scrollline touch");document.addEventListener("touchstart",delegate(this.onTouchStart,this));document.addEventListener("touchmove",delegate(this.onTouchMove,this));document.addEventListener("touchend",delegate(this.onTouchEnd,this))}else{console.log("Scrollline scroll "+this.options.height);$("body").height(this.options.height);$(window).scroll(delegate(this.onScroll,this))}}mf.animation.ScrollLine=ScrollLine;ScrollLine.prototype=new mf.animation.TimeLine;var p=ScrollLine.prototype;p.moveToTime=function(t,options){options=$.extend({moveScrollbar:true},options);delegate(mf.animation.TimeLine.prototype.moveToTime,this)(t,options);if(options.moveScrollbar&&t!=this.time){this.updateScrollbar(t)}};p.updateScrollbar=function(t){var h=window.innerHeight||document.documentElement.clientHeight;$(window).scrollTop(Math.ceil((this.options.height-h)*(t/this.length)))};p.play=function(){$(this).trigger(mf.animation.TimeLine.PLAY);this.moveToTime(this.length,{duration:this.length-this.time,easing:mf.utils.Maths.easeLinear,moveScrollbar:false})};p.onScroll=function(){var h=window.innerHeight||document.documentElement.clientHeight;var t=Math.round(this.length*$(window).scrollTop()/(this.options.height-h));if(Math.abs(t-this.time)<=this.options.minScrollGap){return}this.moveToTime(t,{moveToTime:false})};p.onTouchStart=function(e){e.preventDefault();e.stopImmediatePropagation();this.touch.startY=e.touches[0].pageY;this.touch.startTime=this.time};p.onTouchMove=function(e){e.preventDefault();e.stopImmediatePropagation();var y=e.touches[0].pageY;this.touch.lastDY=y-this.touch.lastY;this.touch.lastY=y;var dy=y-this.touch.startY;var t=Math.max(0,Math.min(this.length,Math.round(this.touch.startTime+this.length*(-dy/this.options.touchHeight))));this.setTime(t,false)};p.onTouchEnd=function(e){if(Math.abs(this.touch.lastDY)>this.options.minScrollGap){var t=Math.max(0,Math.min(this.length,Math.round(this.time+this.length*(-10*this.touch.lastDY/this.options.touchHeight))));this.moveToTime(t,false)}}})(mf=window.mf||{},jQuery);(function(mf,$){mf.animation=mf.animation||{};function Sequencer(){this.length=0;this.animations=[]}mf.animation.Sequencer=Sequencer;var p=Sequencer.prototype;p.register=function(animation){animation=$.extend({start:this.length,duration:100,animate:undefined,animateIn:undefined,animateOut:undefined,started:false},animation);this.animations.push(animation);this.length=Math.max(this.length,animation.start+animation.duration);return animation};p.process=function(t){var dt,animation;for(var i=0,l=this.animations.length;i<l;i++){animation=this.animations[i];dt=t-animation.start;if(animation.started&&(dt<0||dt>=animation.duration)){if(typeof animation.animateOut=="function"){animation.animateOut(dt,animation.duration)}animation.started=false}}for(var i=0,l=this.animations.length;i<l;i++){animation=this.animations[i];dt=t-animation.start;if(!animation.started&&dt>=0&&dt<animation.duration){if(typeof animation.animateIn=="function"){animation.animateIn(dt,animation.duration)}animation.started=true}}for(var i=0,l=this.animations.length;i<l;i++){animation=this.animations[i];dt=t-animation.start;if(dt>=0&&dt<animation.duration){if(typeof animation.animate=="function"){animation.animate(dt,animation.duration)}}}}})(mf=window.mf||{},jQuery);(function(mf){mf.geom=mf.geom||{};function Vector2D(x,y){this.x=x;this.y=y}mf.geom.Vector2D=Vector2D;var p=Vector2D.prototype;p.addVector=function(v){return new Vector2D(this.x+v.x,this.y+v.y)};p.substractVector=function(v){return new Vector2D(this.x-v.x,this.y-v.y)};p.multiply=function(s){return new Vector2D(s*this.x,s*this.y)};p.norm=function(){return Math.sqrt(this.norm2())};p.norm2=function(){return this.x*this.x+this.y*this.y};p.scalarProduct=function(v){return this.x*v.x+this.y*v.y};p.dotProduct=function(v){return this.x*v.y-this.y*v.x};Vector2D.intersection=function(o1,v1,o2,v2){return o1.addVector(v1.multiply(Vector2D.intersectionRatio(o1,v1,o2,v2)))};Vector2D.intersectionRatio=function(o1,v1,o2,v2){return o2.substractVector(o1).dotProduct(v2)/v1.dotProduct(v2)};Vector2D.projection=function(a,o,v){return o.addVector(v.multiply(Vector2D.projectionRatio(a,o,v)))};Vector2D.projectionRatio=function(a,o,v){return v.scalarProduct(a.substractVector(o))/v.norm2()};Vector2D.intersectPoly=function(o,v,points){var polyIn=[];var polyOut=[];var intersections=[];var found=0;for(var i=0;i<points.length;i++){var p1=points[i];var p2=points[(i+1)%points.length];var p1p2=p2.substractVector(p1);switch(found){case 0:case 2:polyIn.push(p1);break;case 1:polyOut.push(p1);break}var r=Vector2D.intersectionRatio(p1,p1p2,o,v);if(r>=0&&r<1&&found<2){found++;var intersection=p1.addVector(p1p2.multiply(r));intersections.push(intersection);polyIn.push(intersection);polyOut.push(intersection)}}return{intersections:intersections,polyIn:polyIn,polyOut:polyOut}}})(mf=window.mf||{});(function(mf){mf.geom=mf.geom||{};mf.geom.projections=mf.geom.projections||{};var GallCalculator=function(x0,y0,width360){this.w=width360;this.x0=x0;this.y0=y0;this.setPhi0(45)};mf.geom.projections.GallCalculator=GallCalculator;GallCalculator.prototype.setPhi0=function(phi0){this.phi0=phi0;this.cosphi0=Math.cos(this.phi0*(Math.PI/180));this.r=180/Math.PI*(this.w/360)/this.cosphi0};GallCalculator.prototype.getXY=function(lat,lng){var x=this.x0+lng*(Math.PI/180)*this.r*this.cosphi0;var y=this.y0-this.r*(1+this.cosphi0)*Math.tan(lat*(Math.PI/180)/2);return{x:x,y:y,lat:lat,lng:lng}};GallCalculator.prototype.getLatLng=function(x,y){var lng=360/this.w*(x-this.x0);var lat=180/Math.PI*2*Math.atan((this.y0-y)/(this.r*(1+this.cosphi0)));return{x:x,y:y,lat:lat,lng:lng}}})(mf=window.mf||{});(function(mf){mf.geom=mf.geom||{};mf.geom.projections=mf.geom.projections||{};var MercatorCalculator=function(x0,y0,width360){this.w=width360;this.x0=x0;this.y0=y0};mf.geom.projections.MercatorCalculator=MercatorCalculator;MercatorCalculator.prototype.getXY=function(lat,lng){var x=this.x0+this.w*lng/360;var y=this.y0-this.w/(2*Math.PI)*Math.log(Math.tan(Math.PI/4+lat*(Math.PI/180)/2));return{x:x,y:y,lat:lat,lng:lng}};MercatorCalculator.prototype.getLatLng=function(x,y){var lng=360/this.w*(x-this.x0);var lat=180/Math.PI*(2*Math.atan(Math.exp((this.y0-y)*(2*Math.PI)/this.w))-Math.PI/2);return{x:x,y:y,lat:lat,lng:lng}}})(mf=window.mf||{});(function(mf){mf.utils=mf.utils||{};function Color(r,g,b){this.r=r;this.g=g;this.b=b}mf.utils.Color=Color;var p=Color.prototype;p.getNBTransform=function(ratio){var rwgt=.3086;var gwgt=.6094;var bwgt=.082;var r=(1-ratio+ratio*rwgt)*this.r+ratio*gwgt*this.g+ratio*bwgt*this.b;var g=ratio*rwgt*this.r+(1-ratio+ratio*gwgt)*this.g+ratio*bwgt*this.b;var b=ratio*rwgt*this.r+ratio*gwgt*this.g+(1-ratio+ratio*bwgt)*this.b;return new Color(r,g,b)};Color.hsb=function(h,s,v){var r=0,g=0,b=0;h=h%360;s/=100;v/=100;h/=60;var i=Math.floor(h);var f=h-i;var p=v*(1-s);var q=v*(1-s*f);var t=v*(1-s*(1-f));if(i==0){r=v;g=t;b=p}else if(i==1){r=q;g=v;b=p}else if(i==2){r=p;g=v;b=t}else if(i==3){r=p;g=q;b=v}else if(i==4){r=t;g=p;b=v}else if(i==5){r=v;g=p;b=q}r=Math.floor(r*255);g=Math.floor(g*255);b=Math.floor(b*255);return new Color(r,g,b)}})(mf=window.mf||{});